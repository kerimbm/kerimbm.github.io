<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTML Editor</title>
  <style type="text/css" media="screen">
    body{
        padding: 0;
        margin: 0;
    }
    #intro{
        font-size: 14px;
        height: 20px;
        line-height: 20px;
        color: rgb(255, 203, 255);
        background-color: rgb(141, 3, 107);
        font-family: 'Courier New', Courier, monospace;
        text-align: center;
    }
    #maindiv, #maindiv::after, #maindiv::before {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        -o-user-select: none;
        user-select: none;

        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;

        -webkit-app-region: no-drag;
        cursor: default;
    }
  </style>
  <script src="../sha512.min.js"></script>
  <script>
      sessionStorage.getItem("connexion")==k?a=true:window.location.href="../connexion.html?d=html-editor&f=index";
  </script>
</head>
<body>

<div id="intro">Un éditeur de code HTML/CSS/JAVASCRIPT en temps réel créé par kerimbm</div>
<div id="maindiv" style="position: relative; width: 100%; height: calc(100vh - 20px);margin: auto;">
    <div id="section1" style="position: relative; width: 40%; height: 100%; float: left;">
        <div id="htmldiv" style="position: relative; width: 100%; height: 60%;">
            <div style="position: relative; text-align: center; background-color: #444449;color:#aaa;border-bottom: 1px solid #333;">HTML</div>
            <div id="edit1" style="position: relative; width: 100%; height: calc(100% - 19px);">
                <pre id="editor1" style="position: relative; width: 100%; height: 100%;margin: 0px;padding: 0px;"></pre>
            </div>
        </div>
        <div id="cssdiv" style="position: relative; width: 100%; height: 20%;">
            <div id="divider1" style="text-align: center; background-color: #444449;color:#aaa; width: 100%; cursor: row-resize;border-bottom: 1px solid #333;">CSS</div>
            <div id="edit2" style="position: relative; width: 100%; height: calc(100% - 19px);">
                <pre id="editor2" style="position: relative; width: 100%; height: 100%;margin: 0px;padding: 0px;"></pre>
            </div>
        </div>
        <div id="jsdiv" style="position: relative; width: 100%; height: 20%;">
            <div id="divider2" style="text-align: center; background-color: #444449;color:#aaa; width: 100%; cursor: row-resize;">JavaScript</div>
            <div id="edit3" style="position: relative; width: 100%; height: calc(100% - 19px);">
                <pre id="editor3" style="position: relative; width: 100%; height: 100%;margin: 0px;padding: 0px;"></pre>
            </div>
        </div>
    </div>
    <div id="splitter" style="top:calc(50% - 50px);left: calc(40% - 5px);width: 10px;height: 40px;background-color: #555559;border-radius: 5px;float: left;position: absolute;z-index: 10;cursor: col-resize;"></div>
    <div id="section2" style="position: relative; width: 60%; height: 100%; float: left;">
        <div id="output" style="position: relative; width: 100%; height: 100%;">
            <div id="inneroutput" style="overflow: hidden; position: relative; width: 100%; height: 100%;">
                <iframe frameborder="0" id="iframe" style="width: 100%; height: 100%;background-color: #eee;"></iframe>
                <div id="mask"  style="display: none; opacity: 0; background-color: red; width: 100%; height: 100%;position: relative; top: calc(-100% - 5px);"></div>
            </div>
        </div>
        
    </div>
</div>


<script>
    // id
    var maindiv = document.getElementById('maindiv');
    var section1 = document.getElementById('section1');
    var section2 = document.getElementById('section2');
    var htmldiv = document.getElementById('htmldiv');
    var cssdiv = document.getElementById('cssdiv');
    var output = document.getElementById('output');
    var jsdiv = document.getElementById('jsdiv');
    var edit1 = document.getElementById('edit1');
    var edit2 = document.getElementById('edit2');
    var edit3 = document.getElementById('edit3');
    var editor1 = document.getElementById('editor1');
    var editor2 = document.getElementById('editor2');
    var editor3 = document.getElementById('editor3');
    var inneroutput = document.getElementById('inneroutput');
    var splitter = document.getElementById('splitter');
    var divider1 = document.getElementById('divider1');
    var divider2 = document.getElementById('divider2');
    var mask = document.getElementById('mask');
    
    // paramètres
    var totalwidth = document.documentElement.clientWidth;           // htmldiv.width + splitter.width + cssdiv.width (500 + 10 + 500)
    var totalheight = document.documentElement.clientHeight;           // section1.height + section2.height
    var minwidth = 150;              // htmldiv ou cssdiv ou output ou jsdiv
    var minheight = 20;              // section1 ou section2 ou htmldiv  ou cssdiv ou output ou jsdiv
    var maintop = 0;                 // position x
    var mainleft = 0;                // position y
    var defaulthtmlwidth = 50;       // largeur par défaut de htmldiv (%)
    var defaultoutputwidth = 50;     // largeur par défaut de output (%)
    var fontsize = '14px';           // taille du texte
    var readonly1 = false;           // editeurs html en lecture seul
    var readonly2 = false;           // editeurs css en lecture seul
    var readonly3 = false;           // editeurs javascript en lecture seul
    var code1 = '';                  // code html initiale
    var code2 = '';                  // code css initiale
    var code3 = '';                  // code javascript initiale
    var basicAutocompletion = true;  // autocomplétion basique
    var snippets = true;             // snippets
    var liveAutocompletion = true;   // autocomplétion live
    
    // évènnements
    var dragging1 = false;
    var dragging2 = false;
    var dragging3 = false;

    // corrigé de bug !!!! essayer de le commenter et voir le résultat.
    var iframedocument = document.getElementById("iframe").contentWindow.document;
    iframedocument.open();
    iframedocument.write('<html><head></head><body></body></html>');
    iframedocument.close();

    window.onload = function(){

        splitter.onmousedown = start1;
        divider1.onmousedown = start2;
        divider2.onmousedown = start3;
        document.onmouseup = stop;
        document.onmousemove = drag;

        /*maindiv.style.top = maintop + 'px';
        maindiv.style.left = mainleft + 'px';
        maindiv.style.width = totalwidth+'px';
        maindiv.style.height = totalheight+'px';
        section1.style.height = totalheight + 'px';
        section2.style.height = totalheight + 'px';
        edit1.style.height = htmldiv.offsetHeight - 19 + 'px';
        editor1.style.height = htmldiv.offsetHeight - 19 + 'px';
        inneroutput.style.height = output.offsetHeight - 19 + 'px';
        jsdiv.style.height = section2.offsetHeight - 19 + 'px';
        edit3.style.height = jsdiv.offsetHeight + 'px';
        editor3.style.height = edit3.offsetHeight + 'px';
*/
        editor1.style.fontSize = fontsize;
        editor2.style.fontSize = fontsize;
        editor3.style.fontSize = fontsize;

        

        
        
    }

    function start1(e){
        dragging1 = true;
        mask.style.display = 'block';
    }

    function start2(e){
        dragging2 = true;
        mask.style.display = 'block';
    }

    function start3(e){
        dragging3 = true;
        mask.style.display = 'block';
    }

    function stop(e){
        dragging1 = false;
        dragging2 = false;
        dragging3 = false;
        mask.style.display = 'none';
    }

    function drag(e){

                xmouse = e.clientX;
                ymouse = e.clientY;

                if(dragging1 && xmouse<maindiv.offsetLeft+minwidth-(document.body.scrollLeft || document.documentElement.scrollLeft))
                    xmouse=maindiv.offsetLeft+minwidth-(document.body.scrollLeft || document.documentElement.scrollLeft);
                else if(dragging1 && xmouse>maindiv.offsetLeft-2+maindiv.offsetWidth-splitter.offsetWidth-minwidth-(document.body.scrollLeft || document.documentElement.scrollLeft))
                    xmouse=maindiv.offsetLeft-2+maindiv.offsetWidth-splitter.offsetWidth-minwidth-(document.body.scrollLeft || document.documentElement.scrollLeft);
                
                else if(dragging2 && ymouse<maindiv.offsetTop+minheight+9-(document.body.scrollTop || document.documentElement.scrollTop))
                    ymouse = maindiv.offsetTop+minheight+9-(document.body.scrollTop || document.documentElement.scrollTop);
                else if(dragging2 && ymouse>maindiv.offsetTop + htmldiv.offsetHeight + cssdiv.offsetHeight + 9 - minheight - (document.body.scrollTop || document.documentElement.scrollTop))
                    ymouse = maindiv.offsetTop + htmldiv.offsetHeight + cssdiv.offsetHeight + 9 - minheight - (document.body.scrollTop || document.documentElement.scrollTop);
                
                else if(dragging3 && ymouse<maindiv.offsetTop+htmldiv.offsetHeight+minheight+9-(document.body.scrollTop || document.documentElement.scrollTop))
                    ymouse = maindiv.offsetTop+htmldiv.offsetHeight+minheight+9-(document.body.scrollTop || document.documentElement.scrollTop);
                else if(dragging3 && ymouse>maindiv.offsetTop + maindiv.offsetHeight + 9 - minheight - (document.body.scrollTop || document.documentElement.scrollTop))
                    ymouse = maindiv.offsetTop + maindiv.offsetHeight + 9 - minheight - (document.body.scrollTop || document.documentElement.scrollTop);

                
                if(dragging1){//splitter
                    section1.style.width = xmouse-maindiv.offsetLeft+(document.body.scrollLeft || document.documentElement.scrollLeft)+'px';
                    section2.style.width = maindiv.offsetWidth - htmldiv.offsetWidth /*- splitter.offsetWidth*/ +'px';
                    splitter.style.left = xmouse-maindiv.offsetLeft+(document.body.scrollLeft || document.documentElement.scrollLeft)-5+'px';
                }
                else if(dragging2){//divider1
                    htmldiv.style.height = ymouse-maindiv.offsetTop-9+(document.body.scrollTop || document.documentElement.scrollTop)+'px';
                    cssdiv.style.height = maindiv.offsetHeight - htmldiv.offsetHeight - jsdiv.offsetHeight  + 'px';

                }
                else if(dragging3){//divider2
                    cssdiv.style.height = ymouse-maindiv.offsetTop-htmldiv.offsetHeight-9+(document.body.scrollTop || document.documentElement.scrollTop)+'px';
                    jsdiv.style.height = maindiv.offsetHeight - htmldiv.offsetHeight - cssdiv.offsetHeight  + 'px';
                }
                ace1.resize();
                ace2.resize();
                ace3.resize();
            }
    // window.onresize = function(){
    //     section2.style.width = maindiv.offsetWidth - section1.offsetWidth + "px";
    //     if(section2.offsetWidth < minwidth){
    //         // section1.style.width = maindiv.offsetWidth - minwidth + "px";
    //         // splitter.style.left = section1.offsetWidth - 5 + "px";
    //     }
    // }
</script>



<!-- load ace -->
<script src="ace-builds-master/src-noconflict/ace.js"></script>
<!-- load ace language tools -->
<script src="ace-builds-master/src-noconflict/ext-language_tools.js"></script>
<script>
    // trigger extension
    ace.require("ace-builds-master/src-noconflict/language_tools");
    var ace1 = ace.edit("editor1");
    ace1.session.setMode("ace/mode/html");
    ace1.setTheme("ace/theme/mytheme");    // 'mytheme' or 'chrome' or 'clouds_midnight' or 'eclipse' or 'xcode'
    ace1.setReadOnly(readonly1);
    ace1.setValue(code1);
    // enable autocompletion and snippets
    ace1.setOptions({
        enableBasicAutocompletion: basicAutocompletion,
        enableSnippets: snippets,
        enableLiveAutocompletion: liveAutocompletion
    });

    var ace2 = ace.edit("editor2");
    ace2.session.setMode("ace/mode/css");
    ace2.setTheme("ace/theme/mytheme");    // rechercher plus de theme sur internet
    ace2.setReadOnly(readonly2);
    ace2.setValue(code2);
    // enable autocompletion and snippets
    ace2.setOptions({
        enableBasicAutocompletion: basicAutocompletion,
        enableSnippets: snippets,
        enableLiveAutocompletion: liveAutocompletion
    });

    var ace3 = ace.edit("editor3");
    ace3.session.setMode("ace/mode/javascript");
    ace3.setTheme("ace/theme/mytheme");
    ace3.setReadOnly(readonly3);
    ace3.setValue(code3);
    // enable autocompletion and snippets
    ace3.setOptions({
        enableBasicAutocompletion: basicAutocompletion,
        enableSnippets: snippets,
        enableLiveAutocompletion: liveAutocompletion
    });

    ace1.session.on('change', function(delta) {
        update();
    });

    ace2.session.on('change', function(delta) {
        update();
    });

    ace3.session.on('change', function(delta) {
        update();
    });

    update = function(){
        // document.getElementById('inneroutput').innerHTML = '<iframe frameborder="0" id="iframe" style="width: 100%; height: 100%;background-color: #eee;"></iframe>\
        //         <div id="mask  style="display: none; opacity: 0; background-color: red; width: 100%; height: 100%;position: relative; top: calc(-100% - 5px);"></div>';
        mask = document.getElementById('mask');

        var iframedocument = document.getElementById("iframe").contentWindow.document;
        iframedocument.open();
        iframedocument.write(ace1.getValue());
        iframedocument.close();
        
        document.title = iframedocument.title;
        
        let headElms = iframedocument.getElementsByTagName('head');
        var tagstyle = iframedocument.createElement('style');
        var textcss = ace2.getValue();
        var codecss = iframedocument.createTextNode(textcss);
        tagstyle.appendChild(codecss);
        if(headElms[0])
            headElms[0].appendChild(tagstyle);
        

        let bodyElms = iframedocument.getElementsByTagName('body');
        var tagscript = iframedocument.createElement('script');
        var textscript = ace3.getValue();
        var codescript = iframedocument.createTextNode(textscript);
        tagscript.appendChild(codescript);
        if(bodyElms[0])
        bodyElms[0].appendChild(tagscript);
    }
</script>

<!--script src="ace-builds-master/demo/show_own_source.js"></script-->
</body>
</html>
